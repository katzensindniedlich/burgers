---
import Layout from '@layouts/Layout.astro'
import LanguagePicker from '@components/LanguagePicker.astro'
import Indicator from '@components/Indicator.astro'
import TextLine from '@components/TextLine.astro'
import Social from '@components/Social.astro'

import Burger from '@images/burger-350x350.png'
import Arrow from '@images/arrow-37x84.png'
import Placeholder from '@images/placeholder-300x300.png'
import Linkedin from '@images/linkedin-64x64.png'
import Youtube from '@images/youtube-64x64.png'
import Twitter from '@images/twitter-64x64.png'
import Instagram from '@images/instagram-64x64.png'
import Facebook from '@images/facebook-64x64.png'
import Github from '@images/github-64x64.png'

import { Image } from 'astro:assets'
export { getLanguagePaths as getStaticPaths } from '@utils'


const
    { text } = Astro.props,
    { locale } = Astro.params,
    meta = text.path['/']
---


<Layout 
    lang={locale} 
    title={meta.title} 
    description={meta.description}
>
    <page id=one class=current>
        <Image
            src={Burger}
            format=png
            alt={text.bruger_alt}
            id=burger
        />
        <text>
            <p set:text={text.welcome} />
            <h1 set:text={text.hello} />
        </text>
        <arrowtext 
            set:text={text.change_lang} 
        />
        <Image
            src={Arrow}
            id=arrow
            alt={text.arrow_alt}
        />
    </page>

    <page id=two>
        <h1
            class=text
            set:text={text.products_title}
            style={{
                'padding-top': '10vh',
                'padding-bottom': '5vh'
            }}
        />
        <TextLine 
            height='calc(.8vw + .8vh)' 
            width=40% 
            margin='0 auto 0 20%' 
            class=text
        />
        <TextLine 
            height='calc(.8vw + .8vh)' 
            width=60% 
            margin='2vh auto 0 auto' 
            class=text
        />
        <carousel>
        { ([1,2,3,4,5]).map(_=>
            <carousel-item>
                <Image
                    src={Placeholder}
                    format=png
                    alt={text.placeholder_alt}
                    id=placeholder
                />
                <TextLine width=75% margin=0 />
            </carousel-item>
        )}
        </carousel>
    </page>

    <page id=three>
        <h1 
            class=text 
            set:text={text.environment_title} 
        />
        <columns>
            <column>
                <Image
                    src={Placeholder}
                    format=png
                    alt={text.placeholder_alt}
                    id=placeholder
                />
                <TextLine width=40% margin='10px 0 0 0' />
                <TextLine />
                <TextLine />
                <TextLine />
                <TextLine width=75% margin=0 />
            </column>
            <column
                <Image
                    src={Placeholder}
                    format=png
                    alt={text.placeholder_alt}
                    id=placeholder
                />
                <TextLine width=40% margin='10px 0 0 0' />
                <TextLine />
                <TextLine />
                <TextLine />
                <TextLine width=75% margin=0 />
            </column>
        </columns>
    </page>

    <page id=four>
        <h1 
            class=text 
            set:text={text.location_title} 
        />
        <columns>
            <column>
                <Image
                    src={Placeholder}
                    format=png
                    alt={text.placeholder_alt}
                    id=placeholder
                />
                <TextLine width=60% margin='10px 0 0 0' />
            </column>
            <column>
                <TextLine width=40% margin=0 />
                <TextLine margin=0 />
                <TextLine margin=0 />
                <TextLine margin=0 />
                <TextLine margin=0 />
                <TextLine margin=0 />
                <TextLine width=75% margin=0 />
            </column>
        </columns>
    </page>

    <page id=five>
        <h1 
            class=text 
            set:text={text.follow_us} 
        />
        <socials>
            <Social
                color=#f5852994
                href=https://www.instagram.com/real.burgers.inc/
                delay=.8s
                imgSrc={Instagram}
            />
            <Social
                color=#ff102780
                href=https://www.youtube.com/
                delay=1s
                imgSrc={Youtube}
            />
            <Social
                color=#08a2e985
                href=https://twitter.com/
                delay=1.2s
                imgSrc={Twitter}
            />
            <Social
                color=#1876f279
                href=https://www.facebook.com/
                delay=1.4s
                imgSrc={Facebook}
            />
            <Social
                color=#0d111785
                href=https://github.com/katzensindniedlich/Burgers/
                delay=1.6s
                imgSrc={Github}
            />
            <Social
                color=#0076b580
                href=https://www.linkedin.com/
                delay=1.8s
                imgSrc={Linkedin}
            />
        </socials>
    </page>

    <Indicator 
        description={text.scroll_note} 
    />
    <LanguagePicker 
        current={locale} 
    />
</Layout>


<style 
    is:global
    lang=scss 
>
    @use 'sass:math';

    $carousel-duration: 15s;
    $carousel-items: 5;
    $carousel-timing: 5;
    $carousel-per-delay: math.div($carousel-duration, $carousel-items);
    $carousel-per-step: math.div(100, $carousel-items);

    @keyframes carousel {
        from {
            opacity: 0;
            transform: translateX(250%) scale(.7)
        }

        #{$carousel-timing}%,
        #{$carousel-per-step}% {
            opacity: .8;
            transform: translateX(150%) scale(.9)
        }

        #{$carousel-per-step + $carousel-timing}%,
        #{$carousel-per-step * 2}% {
            opacity: 1;
            transform: translateX(0) scale(1)
        }

        #{($carousel-per-step * 2) + $carousel-timing}%,
        #{$carousel-per-step * 3}% {
            opacity: .8;
            transform: translateX(-150%) scale(.9)
        }

        #{($carousel-per-step * 3) + $carousel-timing}% {
            opacity: 0;
            transform: translateX(-250%) scale(.9)
        }

        to {
            opacity: 0;
            transform: translateX(-250%) scale(.7)
        }
    }

carousel {
    width: 100%;
    display: flex;
    justify-content: center;
    overflow: hidden;
    
    animation: hide .5s .3s both;

    page.current & {
        animation: show 1.5s .7s both
    }

    carousel-item {
        position: absolute;
        top: 144vh;
        opacity: 0;
        width: fit-content;
        display: flex;
        flex-direction: column;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0px 0px 20px #00000021;
        color: #848d97;
        animation: carousel $carousel-duration cubic-bezier(.37, 0, .63, 1) infinite;

        @for $i from 1 through ($carousel-items - 1) {
            &:nth-child(#{$i}) {
                animation-delay: calc(#{$carousel-per-delay} * #{$i - 2})
            }
        }

        &:last-child {
            animation-delay: calc(-#{$carousel-per-delay} * 2)
        }

        img {
            margin-bottom: 10px;
            box-shadow: 0 0 20px #00000021;
        }

        @media (max-width: 768px) {
            top: 133vh;
            padding: 15px
        }
    }
}
    #arrow {
        position: absolute;
        right: 90px;
        bottom: 75px;

        @media (max-width: 768px) {
            display: none
        }
    }

    @keyframes show-rotated {
        from {
            opacity: 0;
            transform: rotate(30deg)
        }
        to {
            opacity: 1;
            transform: rotate(30deg)
        }
    }

    arrowtext {
        width: 150px;
        position: absolute;
        right: 30px;
        bottom: 165px;

        color: var(--hint-color);
        animation: show-rotated 1s .3s both;
        text-align: center;
        word-wrap: break-word;

        @media (max-width: 768px) {
            display: none
        }
    }

    #burger {
        max-width: 75vw;
        max-height: 50vh;

        animation: wiggle 1.5s infinite;
        filter: drop-shadow(5px 5px 20px black)
    }

    page#one {
        gap: calc(5vh + 3vw)
    }

    page#two {
        display: block
    }

    page#three {
        align-content: space-evenly;
        justify-content: normal
    }



    columns {
        width: 100%;
        display: flex;

        flex-direction: row;
        justify-content: space-evenly;
        margin-bottom: 60px;

        column {
            width: 20%;
            display: flex;
            gap: 15px;
            flex-direction: column;
            
            * {
                animation: hide .5s .3s both;

                page.current & {
                    animation: fade-left 1s 1s both;
                }
            }
            img {
                animation: hide .5s .3s 1 both;
                box-shadow: 0px 0px 20px #00000021;

                page.current & {
                    animation: show 1.5s .7s both;
                }
            }
        }
    }

    @media (max-width: 768px) {
        page#three img, page#four img, carousel carousel-item img {
            height: fit-content;
            max-width: 100%
        }
        column {
            width: 40%!important
        }
        carousel carousel-item:not(:first-child) {
            display: none
        }
        carousel carousel-item:first-child {
            opacity: 1!important;
            animation: unset!important
        }
        page#five div {
            margin-top: 10vh!important
        }
        p {
            margin-bottom: 1.5vh
        }
    }

    page#four {
        align-content: space-evenly;

        columns {
            justify-content: space-around;

            column {
                gap: 20px;
                width: 35%
            }
        }
    }

    socials {
        width: 65vw;
        margin-top: 15vh;

        display: flex;
        justify-content: space-evenly;
        row-gap: 30px;
        flex-wrap: wrap
    }
</style>


<script defer>
(w,d=>{i=d.getElementsByTagName('indicator')[0];l='five';pl={0:'one',1:'two',2:'three',3:'four',4:l};po=new IntersectionObserver(en=>{en.forEach(e=>{if(e.isIntersecting){e.target.classList.add('current')}else{e.target.classList.remove('current')}})},{rootMargin:'0%',threshold:'.8'});ts=0;te=0;function sp(s){n=pl[Math.round(w.scrollY/w.innerHeight)+s];if(n!==undefined){i.style.animation='hide .5s both';d.getElementById(n).scrollIntoView();if(n!==l){i.style.animation='show 1s 2s both'}}};(f=>{f('touchstart',e=>{ts=e.changedTouches[0].screenY});f('touchend',e=>{te=e.changedTouches[0].screenY;if(te>ts){sp(-1)}else if(te<ts){sp(1)}});f('touchmove',e=>{e.preventDefault()},{passive:false});f('keydown',e=>{if(e.key=='ArrowDown'){sp(1);e.preventDefault()}else if(e.key=='ArrowUp'){sp(-1);e.preventDefault()}});f('wheel',e=>{e.preventDefault();(e.deltaY>0)?sp(1):sp(-1)},{passive:false})})(w.addEventListener);d.querySelectorAll('page').forEach(e=>po.observe(e))})(window,document)
</script>